[phases.setup]
nixPkgs = ["nodejs_22", "pnpm-9_x", "openssl", "awscli2", "jq"]

[phases.install]
cmds = [
  "npm install -g corepack@0.24.1 && corepack enable",
  "pnpm i --frozen-lockfile"
]

[phases.build]
cmds = [
  "npx turbo run build",
  # Copy static files for Next.js standalone mode
  "cp -r apps/web/.next/static apps/web/.next/standalone/apps/web/.next/static",
  # Copy public folder if it exists
  "[ -d apps/web/public ] && cp -r apps/web/public apps/web/.next/standalone/apps/web/public || echo 'No public folder to copy'"
]

[start]
cmd = "./start.sh"

# Environment variables that should be available at runtime
[variables]
NODE_ENV = "production"
# Database
DATABASE_URL = ""
SHADOW_DATABASE_URL = ""
# Redis
REDIS_URL = ""
# NextAuth
NEXTAUTH_URL = ""
NEXTAUTH_SECRET = ""
# S3
S3_BUCKET = ""
S3_REGION = ""
S3_ACCESS_KEY_ID = ""
S3_SECRET_ACCESS_KEY = ""
# AWS (for secrets)
AWS_REGION = ""
AWS_ACCESS_KEY_ID = ""
AWS_SECRET_ACCESS_KEY = ""
# PACE API
PACE_API_URL = ""
PACE_USERNAME = ""
PACE_PASSWORD = ""
